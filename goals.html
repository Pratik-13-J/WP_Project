<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FinTrack - Goals</title>
  <link rel="stylesheet" href="dashboard-styles.css">
  <script src="data-manager.js"></script>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <h2>FinTrack</h2>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li>
            <a href="dashboard.html">Overview</a>
          </li>
          <li>
            <a href="transactions.html">Transactions</a>
          </li>
          <li>
            <a href="budgets.html">Budgets</a>
          </li>
          <li class="active">
            <a href="goals.html">Goals</a>
          </li>
          <li>
            <a href="reports.html">Reports</a>
          </li>
          <li>
            <a href="settings.html">Settings</a>
          </li>
        </ul>
      </nav>
      <div class="user-info">
        <div class="user-avatar" onclick="window.location.href='profile.html'">
          <img src="/placeholder.svg?height=40&width=40" alt="User Avatar" id="user-avatar-small">
        </div>
        <div class="user-details">
          <p class="user-name" id="user-name-sidebar"></p>
          <a href="index.html" class="logout-link">Logout</a>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Top Navigation -->
      <header class="top-nav">
        <div class="mobile-toggle" onclick="toggleSidebar()">
          <span>â˜°</span>
        </div>
        <div class="search-bar">
          <input type="text" placeholder="Search goals..." id="goal-search" onkeyup="filterGoals()">
        </div>
        <div class="top-nav-actions">
          <a href="notifications.html" class="btn-icon">
            <span class="notification-icon">ðŸ””</span>
            <span class="notification-badge" id="notification-count"></span>
          </a>
          <a href="profile.html" class="btn-icon">
            <span class="profile-icon">ðŸ‘¤</span>
          </a>
        </div>
      </header>

      <!-- Goals Content -->
      <div class="dashboard-content">
        <h1>Financial Goals</h1>
        
        <div class="action-bar">
          <button class="add-btn" onclick="showAddGoalModal()">Add New Goal</button>
        </div>
        
        <div class="goals-container" id="goals-container">
          <!-- Goals will be loaded dynamically -->
        </div>
      </div>
    </main>
  </div>

  <!-- Add Goal Modal -->
  <div id="addGoalModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addGoalModal')">&times;</span>
      <h2 id="goalModalTitle">Add New Goal</h2>
      <form id="goalForm" onsubmit="saveGoal(event)">
        <div class="form-group">
          <label for="goal-name">Goal Name</label>
          <input type="text" id="goal-name" required>
        </div>
        <div class="form-group">
          <label for="goal-target">Target Amount</label>
          <input type="number" id="goal-target" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="goal-current">Current Amount</label>
          <input type="number" id="goal-current" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="goal-deadline">Deadline</label>
          <input type="date" id="goal-deadline" required>
        </div>
        <div class="form-group">
          <label for="goal-notes">Notes (Optional)</label>
          <textarea id="goal-notes"></textarea>
        </div>
        <input type="hidden" id="goal-id">
        <button type="submit" class="submit-btn" id="goal-submit-btn">Add Goal</button>
      </form>
    </div>
  </div>

  <!-- Contribute to Goal Modal -->
  <div id="contributeGoalModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('contributeGoalModal')">&times;</span>
      <h2>Add Contribution to <span id="contribution-goal-name"></span></h2>
      <form id="contributionForm" onsubmit="saveContribution(event)">
        <div class="form-group">
          <label for="contribution-amount">Amount</label>
          <input type="number" id="contribution-amount" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="contribution-date">Date</label>
          <input type="date" id="contribution-date" required>
        </div>
        <div class="form-group">
          <label for="contribution-notes">Notes (Optional)</label>
          <textarea id="contribution-notes"></textarea>
        </div>
        <input type="hidden" id="contribution-goal-id">
        <button type="submit" class="submit-btn">Add Contribution</button>
      </form>
    </div>
  </div>

  <script>
    // Global variables
    let currentGoals = [];
    let editingGoal = null;
    let selectedGoal = null;

    // Load user data
    function loadUserData() {
      const user = DataManager.getUser();
      document.getElementById('user-name-sidebar').textContent = user.name;
      document.getElementById('user-avatar-small').src = user.avatar;
    }

    // Load goals
    function loadGoals() {
      currentGoals = DataManager.getGoals();
      renderGoals();
    }

    // Render goals
    function renderGoals() {
      const goalsContainer = document.getElementById('goals-container');
      goalsContainer.innerHTML = '';
      
      if (currentGoals.length === 0) {
        goalsContainer.innerHTML = '<p class="no-data">No goals found. Create your first goal!</p>';
        return;
      }
      
      currentGoals.forEach(goal => {
        const percentage = DataManager.getGoalPercentage(goal);
        
        const goalCard = document.createElement('div');
        goalCard.className = 'goal-card';
        
        goalCard.innerHTML = `
          <div class="goal-header">
            <h3>${goal.name}</h3>
            <div class="goal-actions">
              <button class="action-btn edit" onclick="editGoal(${goal.id})">Edit</button>
              <button class="action-btn delete" onclick="deleteGoal(${goal.id})">Delete</button>
            </div>
          </div>
          <div class="goal-details">
            <p>Target: ${DataManager.formatCurrency(goal.target)}</p>
            <p>Current: ${DataManager.formatCurrency(goal.current)}</p>
            <p>Deadline: ${goal.formattedDeadline}</p>
          </div>
          <div class="goal-progress">
            <div class="progress-bar" style="width: ${percentage}%;"></div>
          </div>
          <div class="goal-status">
            <span>${percentage}% completed</span>
          </div>
          <button class="contribute-btn" onclick="contributeToGoal(${goal.id})">Add Contribution</button>
        `;
        
        goalsContainer.appendChild(goalCard);
      });
    }

    // Filter goals
    function filterGoals() {
      const searchFilter = document.getElementById('goal-search').value.toLowerCase();
      
      const allGoals = DataManager.getGoals();
      
      currentGoals = allGoals.filter(goal => {
        // Filter by search
        if (searchFilter) {
          const name = goal.name.toLowerCase();
          const notes = goal.notes.toLowerCase();
          
          if (!name.includes(searchFilter) && !notes.includes(searchFilter)) {
            return false;
          }
        }
        
        return true;
      });
      
      renderGoals();
    }

    // Show add goal modal
    function showAddGoalModal() {
      document.getElementById('goalModalTitle').textContent = 'Add New Goal';
      document.getElementById('goal-submit-btn').textContent = 'Add Goal';
      document.getElementById('goalForm').reset();
      
      // Set a default deadline (3 months from now)
      const defaultDeadline = new Date();
      defaultDeadline.setMonth(defaultDeadline.getMonth() + 3);
      document.getElementById('goal-deadline').value = defaultDeadline.toISOString().split('T')[0];
      
      document.getElementById('goal-id').value = '';
      editingGoal = null;
      
      document.getElementById('addGoalModal').style.display = 'flex';
    }

    // Edit goal
    function editGoal(id) {
      const goal = DataManager.getGoals().find(g => g.id === id);
      
      if (goal) {
        editingGoal = goal;
        
        document.getElementById('goalModalTitle').textContent = 'Edit Goal';
        document.getElementById('goal-submit-btn').textContent = 'Update Goal';
        
        document.getElementById('goal-name').value = goal.name;
        document.getElementById('goal-target').value = goal.target;
        document.getElementById('goal-current').value = goal.current;
        document.getElementById('goal-deadline').value = goal.deadline;
        document.getElementById('goal-notes').value = goal.notes;
        document.getElementById('goal-id').value = goal.id;
        
        document.getElementById('addGoalModal').style.display = 'flex';
      }
    }

    // Save goal
    function saveGoal(event) {
      event.preventDefault();
      
      const goalData = {
        name: document.getElementById('goal-name').value,
        target: parseFloat(document.getElementById('goal-target').value),
        current: parseFloat(document.getElementById('goal-current').value),
        deadline: document.getElementById('goal-deadline').value,
        notes: document.getElementById('goal-notes').value
      };
      
      const goalId = document.getElementById('goal-id').value;
      
      if (goalId) {
        // Update existing goal
        goalData.id = parseInt(goalId);
        DataManager.updateGoal(goalData);
      } else {
        // Add new goal
        DataManager.addGoal(goalData);
      }
      
      // Reload goals
      loadGoals();
      
      // Close modal
      closeModal('addGoalModal');
      
      // Show notification
      alert(goalId ? 'Goal updated successfully!' : 'Goal added successfully!');
    }

    // Delete goal
    function deleteGoal(id) {
      if (confirm('Are you sure you want to delete this goal?')) {
        DataManager.deleteGoal(id);
        loadGoals();
        alert('Goal deleted successfully!');
      }
    }

    // Contribute to goal
    function contributeToGoal(id) {
      const goal = DataManager.getGoals().find(g => g.id === id);
      
      if (goal) {
        selectedGoal = goal;
        
        document.getElementById('contribution-goal-name').textContent = goal.name;
        document.getElementById('contribution-goal-id').value = goal.id;
        
        // Reset form
        document.getElementById('contributionForm').reset();
        
        // Set today's date as default
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('contribution-date').value = today;
        
        document.getElementById('contributeGoalModal').style.display = 'flex';
      }
    }

    // Save contribution
    function saveContribution(event) {
      event.preventDefault();
      
      const goalId = parseInt(document.getElementById('contribution-goal-id').value);
      const amount = parseFloat(document.getElementById('contribution-amount').value);
      
      DataManager.contributeToGoal(goalId, amount);
      
      // Reload goals
      loadGoals();
      
      // Close modal
      closeModal('contributeGoalModal');
      
      // Show notification
      alert('Contribution added successfully!');
    }

    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Load notification count
    function loadNotificationCount() {
      const notifications = DataManager.getNotifications();
      const unreadCount = notifications.filter(n => !n.read).length;
      
      const notificationCountElement = document.getElementById('notification-count');
      
      if (unreadCount > 0) {
        notificationCountElement.textContent = unreadCount;
        notificationCountElement.style.display = 'flex';
      } else {
        notificationCountElement.style.display = 'none';
      }
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      loadUserData();
      loadGoals();
      loadNotificationCount();
    });

    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    };
  </script>
</body>
</html>

