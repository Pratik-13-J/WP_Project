<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FinTrack - Budgets</title>
  <link rel="stylesheet" href="dashboard-styles.css">
  <script src="data-manager.js"></script>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <h2>FinTrack</h2>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li>
            <a href="dashboard.html">Overview</a>
          </li>
          <li>
            <a href="transactions.html">Transactions</a>
          </li>
          <li class="active">
            <a href="budgets.html">Budgets</a>
          </li>
          <li>
            <a href="goals.html">Goals</a>
          </li>
          <li>
            <a href="reports.html">Reports</a>
          </li>
          <li>
            <a href="settings.html">Settings</a>
          </li>
        </ul>
      </nav>
      <div class="user-info">
        <div class="user-avatar" onclick="window.location.href='profile.html'">
          <img src="avatar.jpg" alt="User Avatar" id="user-avatar-small">
        </div>
        <div class="user-details">
          <p class="user-name" id="user-name-sidebar"></p>
          <a href="index.html" class="logout-link">Logout</a>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Top Navigation -->
      <header class="top-nav">
        <div class="mobile-toggle" onclick="toggleSidebar()">
          <span>â˜°</span>
        </div>
        <div class="search-bar">
          <input type="text" placeholder="Search budgets..." id="budget-search" onkeyup="filterBudgets()">
        </div>
        <div class="top-nav-actions">
          <a href="notifications.html" class="btn-icon">
            <span class="notification-icon">ðŸ””</span>
            <span class="notification-badge" id="notification-count"></span>
          </a>
          <a href="profile.html" class="btn-icon">
            <span class="profile-icon">ðŸ‘¤</span>
          </a>
        </div>
      </header>

      <!-- Budgets Content -->
      <div class="dashboard-content">
        <h1>Budgets</h1>
        
        <div class="action-bar">
          <div class="filter-options">
            <select id="budget-period" onchange="filterBudgets()">
              <option value="all">All Periods</option>
              <option value="month" selected>Monthly</option>
              <option value="quarter">Quarterly</option>
              <option value="year">Yearly</option>
            </select>
          </div>
          <button class="add-btn" onclick="showAddBudgetModal()">Create Budget</button>
        </div>
        
        <div class="budget-cards" id="budget-cards">
          <!-- Budget cards will be loaded dynamically -->
        </div>
      </div>
    </main>
  </div>

  <!-- Add Budget Modal -->
  <div id="addBudgetModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addBudgetModal')">&times;</span>
      <h2 id="budgetModalTitle">Create Budget</h2>
      <form id="budgetForm" onsubmit="saveBudget(event)">
        <div class="form-group">
          <label for="budget-category">Category</label>
          <select id="budget-category" required>
            <option value="Food">Food</option>
            <option value="Shopping">Shopping</option>
            <option value="Transport">Transport</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Housing">Housing</option>
            <option value="Utilities">Utilities</option>
            <option value="Health">Health</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="budget-limit">Budget Limit</label>
          <input type="number" id="budget-limit" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="budget-period-select">Period</label>
          <select id="budget-period-select" required>
            <option value="month">Monthly</option>
            <option value="quarter">Quarterly</option>
            <option value="year">Yearly</option>
          </select>
        </div>
        <input type="hidden" id="budget-id">
        <button type="submit" class="submit-btn" id="budget-submit-btn">Create Budget</button>
      </form>
    </div>
  </div>

  <script>
    // Global variables
    let currentBudgets = [];
    let editingBudget = null;

    // Load user data
    function loadUserData() {
      const user = DataManager.getUser();
      document.getElementById('user-name-sidebar').textContent = user.name;
      document.getElementById('user-avatar-small').src = user.avatar;
    }

    // Load budgets
    function loadBudgets() {
      currentBudgets = DataManager.getBudgets();
      renderBudgets();
    }

    // Render budgets
    function renderBudgets() {
      const budgetCardsContainer = document.getElementById('budget-cards');
      budgetCardsContainer.innerHTML = '';
      
      if (currentBudgets.length === 0) {
        budgetCardsContainer.innerHTML = '<p class="no-data">No budgets found. Create your first budget!</p>';
        return;
      }
      
      currentBudgets.forEach(budget => {
        const percentage = DataManager.getBudgetPercentage(budget);
        const color = DataManager.getBudgetColor(budget);
        const isOverBudget = budget.spent > budget.limit;
        
        const budgetCard = document.createElement('div');
        budgetCard.className = 'budget-card';
        
        budgetCard.innerHTML = `
          <div class="budget-header">
            <h3>${budget.category}</h3>
            <div class="budget-actions">
              <button class="action-btn edit" onclick="editBudget(${budget.id})">Edit</button>
              <button class="action-btn delete" onclick="deleteBudget(${budget.id})">Delete</button>
            </div>
          </div>
          <div class="budget-amount">
            <span>${DataManager.formatCurrency(budget.spent)} / ${DataManager.formatCurrency(budget.limit)}</span>
          </div>
          <div class="budget-progress">
            <div class="progress-bar" style="width: ${percentage}%; background-color: ${color};"></div>
          </div>
          <div class="budget-status">
            <span ${isOverBudget ? 'class="over-budget"' : ''}>
              ${percentage}% 
              ${isOverBudget ? 'over budget!' : 'used'}
            </span>
          </div>
        `;
        
        budgetCardsContainer.appendChild(budgetCard);
      });
    }

    // Filter budgets
    function filterBudgets() {
      const periodFilter = document.getElementById('budget-period').value;
      const searchFilter = document.getElementById('budget-search').value.toLowerCase();
      
      const allBudgets = DataManager.getBudgets();
      
      currentBudgets = allBudgets.filter(budget => {
        // Filter by period
        if (periodFilter !== 'all' && budget.period !== periodFilter) {
          return false;
        }
        
        // Filter by search
        if (searchFilter) {
          const category = budget.category.toLowerCase();
          
          if (!category.includes(searchFilter)) {
            return false;
          }
        }
        
        return true;
      });
      
      renderBudgets();
    }

    // Show add budget modal
    function showAddBudgetModal() {
      document.getElementById('budgetModalTitle').textContent = 'Create Budget';
      document.getElementById('budget-submit-btn').textContent = 'Create Budget';
      document.getElementById('budgetForm').reset();
      
      document.getElementById('budget-id').value = '';
      editingBudget = null;
      
      document.getElementById('addBudgetModal').style.display = 'flex';
    }

    // Edit budget
    function editBudget(id) {
      const budget = DataManager.getBudgets().find(b => b.id === id);
      
      if (budget) {
        editingBudget = budget;
        
        document.getElementById('budgetModalTitle').textContent = 'Edit Budget';
        document.getElementById('budget-submit-btn').textContent = 'Update Budget';
        
        document.getElementById('budget-category').value = budget.category;
        document.getElementById('budget-limit').value = budget.limit;
        document.getElementById('budget-period-select').value = budget.period;
        document.getElementById('budget-id').value = budget.id;
        
        document.getElementById('addBudgetModal').style.display = 'flex';
      }
    }

    // Save budget
    function saveBudget(event) {
      event.preventDefault();
      
      const budgetData = {
        category: document.getElementById('budget-category').value,
        limit: parseFloat(document.getElementById('budget-limit').value),
        period: document.getElementById('budget-period-select').value
      };
      
      const budgetId = document.getElementById('budget-id').value;
      
      if (budgetId) {
        // Update existing budget
        budgetData.id = parseInt(budgetId);
        DataManager.updateBudget(budgetData);
      } else {
        // Add new budget
        DataManager.addBudget(budgetData);
      }
      
      // Reload budgets
      loadBudgets();
      
      // Close modal
      closeModal('addBudgetModal');
      
      // Show notification
      alert(budgetId ? 'Budget updated successfully!' : 'Budget created successfully!');
    }

    // Delete budget
    function deleteBudget(id) {
      if (confirm('Are you sure you want to delete this budget?')) {
        DataManager.deleteBudget(id);
        loadBudgets();
        alert('Budget deleted successfully!');
      }
    }

    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Load notification count
    function loadNotificationCount() {
      const notifications = DataManager.getNotifications();
      const unreadCount = notifications.filter(n => !n.read).length;
      
      const notificationCountElement = document.getElementById('notification-count');
      
      if (unreadCount > 0) {
        notificationCountElement.textContent = unreadCount;
        notificationCountElement.style.display = 'flex';
      } else {
        notificationCountElement.style.display = 'none';
      }
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      loadUserData();
      loadBudgets();
      loadNotificationCount();
    });

    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    };
  </script>
</body>
</html>

