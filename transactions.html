<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FinTrack - Transactions</title>
  <link rel="stylesheet" href="dashboard-styles.css">
  <script src="data-manager.js"></script>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <h2>FinTrack</h2>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li>
            <a href="dashboard.html">Overview</a>
          </li>
          <li class="active">
            <a href="transactions.html">Transactions</a>
          </li>
          <li>
            <a href="budgets.html">Budgets</a>
          </li>
          <li>
            <a href="goals.html">Goals</a>
          </li>
          <li>
            <a href="reports.html">Reports</a>
          </li>
          <li>
            <a href="settings.html">Settings</a>
          </li>
        </ul>
      </nav>
      <div class="user-info">
        <div class="user-avatar" onclick="window.location.href='profile.html'">
          <img src="/placeholder.svg?height=40&width=40" alt="User Avatar" id="user-avatar-small">
        </div>
        <div class="user-details">
          <p class="user-name" id="user-name-sidebar"></p>
          <a href="index.html" class="logout-link">Logout</a>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Top Navigation -->
      <header class="top-nav">
        <div class="mobile-toggle" onclick="toggleSidebar()">
          <span>â˜°</span>
        </div>
        <div class="search-bar">
          <input type="text" placeholder="Search transactions..." id="transaction-search" onkeyup="filterTransactions()">
        </div>
        <div class="top-nav-actions">
          <a href="notifications.html" class="btn-icon">
            <span class="notification-icon">ðŸ””</span>
            <span class="notification-badge" id="notification-count"></span>
          </a>
          <a href="profile.html" class="btn-icon">
            <span class="profile-icon">ðŸ‘¤</span>
          </a>
        </div>
      </header>

      <!-- Transactions Content -->
      <div class="dashboard-content">
        <h1>Transactions</h1>
        
        <div class="action-bar">
          <div class="filter-options">
            <select id="category-filter" onchange="filterTransactions()">
              <option value="">All Categories</option>
              <option value="food">Food</option>
              <option value="shopping">Shopping</option>
              <option value="transport">Transport</option>
              <option value="entertainment">Entertainment</option>
              <option value="income">Income</option>
              <option value="utilities">Utilities</option>
              <option value="health">Health</option>
              <option value="other">Other</option>
            </select>
            <select id="period-filter" onchange="filterTransactions()">
              <option value="all">All Time</option>
              <option value="month">This Month</option>
              <option value="week">This Week</option>
              <option value="day">Today</option>
            </select>
          </div>
          <button class="add-btn" onclick="showAddTransactionModal()">Add Transaction</button>
        </div>
        
        <div class="transactions-table">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
                <th>Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="transactions-table-body">
              <!-- Transactions will be loaded dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Transaction Modal -->
  <div id="addTransactionModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addTransactionModal')">&times;</span>
      <h2 id="transactionModalTitle">Add Transaction</h2>
      <form id="transactionForm" onsubmit="saveTransaction(event)">
        <div class="form-group">
          <label for="transaction-description">Description</label>
          <input type="text" id="transaction-description" required>
        </div>
        <div class="form-group">
          <label for="transaction-amount">Amount</label>
          <input type="number" id="transaction-amount" step="0.01" required>
          <div class="amount-type">
            <label>
              <input type="radio" name="transaction-type" value="expense" checked> Expense
            </label>
            <label>
              <input type="radio" name="transaction-type" value="income"> Income
            </label>
          </div>
        </div>
        <div class="form-group">
          <label for="transaction-category">Category</label>
          <select id="transaction-category" required>
            <option value="food">Food</option>
            <option value="shopping">Shopping</option>
            <option value="transport">Transport</option>
            <option value="entertainment">Entertainment</option>
            <option value="income">Income</option>
            <option value="utilities">Utilities</option>
            <option value="health">Health</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="transaction-date">Date</label>
          <input type="date" id="transaction-date" required>
        </div>
        <div class="form-group">
          <label for="transaction-notes">Notes (Optional)</label>
          <textarea id="transaction-notes"></textarea>
        </div>
        <input type="hidden" id="transaction-id">
        <button type="submit" class="submit-btn" id="transaction-submit-btn">Add Transaction</button>
      </form>
    </div>
  </div>

  <script>
    // Global variables
    let currentTransactions = [];
    let editingTransaction = null;

    // Load user data
    function loadUserData() {
      const user = DataManager.getUser();
      document.getElementById('user-name-sidebar').textContent = user.name;
      document.getElementById('user-avatar-small').src = user.avatar;
    }

    // Load transactions
    function loadTransactions() {
      currentTransactions = DataManager.getTransactions();
      renderTransactions();
    }

    // Render transactions
    function renderTransactions() {
      const tableBody = document.getElementById('transactions-table-body');
      tableBody.innerHTML = '';
      
      if (currentTransactions.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="5" class="no-data">No transactions found.</td>';
        tableBody.appendChild(row);
        return;
      }
      
      currentTransactions.forEach(transaction => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td>${transaction.formattedDate}</td>
          <td>${transaction.description}</td>
          <td>
            <span class="category-badge ${transaction.category}">
              ${transaction.icon} ${transaction.category}
            </span>
          </td>
          <td class="${transaction.amount < 0 ? 'negative' : ''}">${DataManager.formatCurrency(transaction.amount)}</td>
          <td>
            <button class="action-btn edit" onclick="editTransaction(${transaction.id})">Edit</button>
            <button class="action-btn delete" onclick="deleteTransaction(${transaction.id})">Delete</button>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    }

    // Filter transactions
    function filterTransactions() {
      const categoryFilter = document.getElementById('category-filter').value;
      const periodFilter = document.getElementById('period-filter').value;
      const searchFilter = document.getElementById('transaction-search').value.toLowerCase();
      
      const allTransactions = DataManager.getTransactions();
      
      currentTransactions = allTransactions.filter(transaction => {
        // Filter by category
        if (categoryFilter && transaction.category !== categoryFilter) {
          return false;
        }
        
        // Filter by period
        if (periodFilter !== 'all') {
          const transactionDate = new Date(transaction.date);
          const today = new Date();
          
          if (periodFilter === 'day' && transactionDate.toDateString() !== today.toDateString()) {
            return false;
          }
          
          if (periodFilter === 'week') {
            const weekAgo = new Date(today);
            weekAgo.setDate(today.getDate() - 7);
            if (transactionDate < weekAgo) {
              return false;
            }
          }
          
          if (periodFilter === 'month') {
            if (transactionDate.getMonth() !== today.getMonth() || 
                transactionDate.getFullYear() !== today.getFullYear()) {
              return false;
            }
          }
        }
        
        // Filter by search
        if (searchFilter) {
          const description = transaction.description.toLowerCase();
          const category = transaction.category.toLowerCase();
          const notes = transaction.notes.toLowerCase();
          
          if (!description.includes(searchFilter) && 
              !category.includes(searchFilter) && 
              !notes.includes(searchFilter)) {
            return false;
          }
        }
        
        return true;
      });
      
      renderTransactions();
    }

    // Show add transaction modal
    function showAddTransactionModal() {
      document.getElementById('transactionModalTitle').textContent = 'Add Transaction';
      document.getElementById('transaction-submit-btn').textContent = 'Add Transaction';
      document.getElementById('transactionForm').reset();
      
      // Set today's date as default
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('transaction-date').value = today;
      
      document.getElementById('transaction-id').value = '';
      editingTransaction = null;
      
      document.getElementById('addTransactionModal').style.display = 'flex';
    }

    // Edit transaction
    function editTransaction(id) {
      const transaction = DataManager.getTransactions().find(t => t.id === id);
      
      if (transaction) {
        editingTransaction = transaction;
        
        document.getElementById('transactionModalTitle').textContent = 'Edit Transaction';
        document.getElementById('transaction-submit-btn').textContent = 'Update Transaction';
        
        document.getElementById('transaction-description').value = transaction.description;
        document.getElementById('transaction-amount').value = Math.abs(transaction.amount);
        document.getElementById('transaction-category').value = transaction.category;
        
        // Set transaction type
        const transactionType = transaction.amount < 0 ? 'expense' : 'income';
        document.querySelector(`input[name="transaction-type"][value="${transactionType}"]`).checked = true;
        
        // Format date for input
        const date = new Date(transaction.date);
        const formattedDate = date.toISOString().split('T')[0];
        document.getElementById('transaction-date').value = formattedDate;
        
        document.getElementById('transaction-notes').value = transaction.notes;
        document.getElementById('transaction-id').value = transaction.id;
        
        document.getElementById('addTransactionModal').style.display = 'flex';
      }
    }

    // Save transaction
    function saveTransaction(event) {
      event.preventDefault();
      
      const transactionData = {
        description: document.getElementById('transaction-description').value,
        amount: parseFloat(document.getElementById('transaction-amount').value),
        type: document.querySelector('input[name="transaction-type"]:checked').value,
        category: document.getElementById('transaction-category').value,
        date: document.getElementById('transaction-date').value,
        notes: document.getElementById('transaction-notes').value
      };
      
      const transactionId = document.getElementById('transaction-id').value;
      
      if (transactionId) {
        // Update existing transaction
        transactionData.id = parseInt(transactionId);
        DataManager.updateTransaction(transactionData);
      } else {
        // Add new transaction
        DataManager.addTransaction(transactionData);
      }
      
      // Reload transactions
      loadTransactions();
      
      // Close modal
      closeModal('addTransactionModal');
      
      // Show notification
      alert(transactionId ? 'Transaction updated successfully!' : 'Transaction added successfully!');
    }

    // Delete transaction
    function deleteTransaction(id) {
      if (confirm('Are you sure you want to delete this transaction?')) {
        DataManager.deleteTransaction(id);
        loadTransactions();
        alert('Transaction deleted successfully!');
      }
    }

    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Load notification count
    function loadNotificationCount() {
      const notifications = DataManager.getNotifications();
      const unreadCount = notifications.filter(n => !n.read).length;
      
      const notificationCountElement = document.getElementById('notification-count');
      
      if (unreadCount > 0) {
        notificationCountElement.textContent = unreadCount;
        notificationCountElement.style.display = 'flex';
      } else {
        notificationCountElement.style.display = 'none';
      }
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      loadUserData();
      loadTransactions();
      loadNotificationCount();
      
      // Set today's date as default for new transactions
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('transaction-date').value = today;
    });

    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    };
  </script>
</body>
</html>

